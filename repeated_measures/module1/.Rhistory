install.packages("glmm")
library(glmm)
data("salamander")
salamander
write(salamander, "salamander.csv")
write(salamander, file="salamander.csv",sep=",")
cwd()
knitr::opts_chunk$set(echo = TRUE)
library(psych)
library(tidyverse)
nlsy<-read.csv("/Users/dc/test_stuff/analysis_factor/datasets_irc_workshop/NLSY.csv")
library(psych)
library(tidyverse)
nlsy<-read.csv("NLSY.csv")
library(psych)
library(tidyverse)
nlsy<-read.csv("/Users/dc/analysis_factor/datasets_irc_workshop/NLSY.csv")
library(psych)
library(tidyverse)
nlsy<-read.csv("/Users/dc/analysis_factor/workshop/datasets_irc_workshop/NLSY.csv")
write(nlsy, file = "nlsy_clean.csv",
append = FALSE, sep = ",")
write(nlsy, file = "nlsy_clean.csv",
ncolumns = if(is.character(x)) 1 else 5,
append = FALSE, sep = ",")
write(nlsy, file = "nlsy_clean.csv",
ncolumns = if(is.character(nlsy)) 1 else 5,
append = FALSE, sep = ",")
sapply(nlsy,class)
sapply(nlsy,class)
nlsy
colnames(nlsy)
colnames(nlsy)
#R0000100 ID, not data
#PCS2000 composite physical health score, Y, plot all Xn vs PCS2000
plot(nlsy$CESD2000Total, nlsy$PCS2000)
plot(nlsy$CESDTotal2000cutpt, nlsy$PCS2000)
plot(nlsy$MCS2000, nlsy$PCS2000)
plot(nlsy$RelAt2000cat6, nlsy$PCS2000)
plot(nlsy$RelAt2000cat2, nlsy$PCS2000)
plot(nlsy$NumberBioStepAdoptChildHH2000, nlsy$PCS2000)
plot(nlsy$BioChildHH2000c2, nlsy$PCS2000)
plot(nlsy$WorkTimeHrsperWkPastCalYr2000cat4, nlsy$PCS2000)
plot(nlsy$UnemplyWksPastCal2000c, nlsy$PCS2000)
plot(nlsy$UnemployedWksPastCal2000cont, nlsy$PCS2000)
plot(nlsy$IncomePercNetFam2000c, nlsy$PCS2000)
plot(nlsy$PovertyStatus2000c2, nlsy$PCS2000)
head(nlsy)
dim(nlsy)
dim(nlsy)
nlsy_clean<-na.omit(nlsy)
dim(nlsy_clean)
dim(nlsy)
nlsy_clean<-na.omit(nlsy)
dim(nlsy_clean)
write.csv(nlsy_clean,"clean.csv")
dim(nlsy)
nlsy_clean<-na.omit(nlsy)
dim(nlsy_clean)
write.csv(nlsy_clean,"clean.csv")
getwd()
dim(nlsy)
nlsy_clean<-na.omit(nlsy)
dim(nlsy_clean)
write.csv(nlsy_clean,"clean.csv")
getwd()
knitr::opts_chunk$set(echo = TRUE)
library(psych)
library(tidyverse)
nlsy<-read.csv("/Users/dc/analysis_factor/workshop/datasets_irc_workshop/NLSY.csv")
dim(nlsy)
nlsy_clean<-na.omit(nlsy)
dim(nlsy_clean)
write.csv(nlsy_clean,"clean.csv")
getwd()
dim(nlsy)
nlsy_clean<-na.omit(nlsy)
dim(nlsy_clean)
write.csv(nlsy_clean,"clean.csv")
getwd()
cwd("/Users/dc/test_stuff/repeated_measures/west_book")
setwd("/Users/dc/test_stuff/repeated_measures/west_book")
setwd("/Users/dc/test_stuff/repeated_measures/west_book")
rat_pup<-read.csv("rat_pup/rat_pup.dat.txt")
rat_pup
View(rat_pup)
setwd("/Users/dc/test_stuff/repeated_measures/west_book")
rat_pup<-read.table("rat_pup/rat_pup.dat",h=T)
rat_pup
View(rat_pup)
attach(ratpup)
attach(rat_pup)
install.packages("HMisc")
library(HMisc)
attach(rat_pup)
install.packages("Hmisc")
library(Hmisc)
attach(rat_pup)
#install.packages("Hmisc")
library(Hmisc)
g <- function(x)c(N=length(x),MEAN=mean(x,na.rm=TRUE),SD=sd(x,na.rm=TRUE),MIN=min(x,na.rm=TRUE),MAX=max(x,na.rm=TRUE))
summarize(weight,by=llist(treatment,sex),g)
attach(rat_pup)
#install.packages("Hmisc")
library(Hmisc)
g <- function(x)c(N=length(x),MEAN=mean(x,na.rm=TRUE),SD=sd(x,na.rm=TRUE),MIN=min(x,na.rm=TRUE),MAX=max(x,na.rm=TRUE))
summarize(weight,by=llist(treatment,sex),g)
#install.packages("Hmisc")
library(Hmisc)
library(lattice)  # trellis graphics
library(grid)
bwplot(weight ~ sex|treatment, data=ratpup,aspect = 2, ylab="Birth Weights",
xlab="SEX",main = "Boxplots of birth weights for levels of treatment by sex")
bwplot(weight ~ sex|treatment, data=rat_pup,aspect = 2, ylab="Birth Weights",
xlab="SEX",main = "Boxplots of birth weights for levels of treatment by sex")
ranklit <- litsize+0.01*litter
sort(ranklit)
ranklit
ranklit <- factor(ranklit)
levels(ranklit) <- c( "1","2", "3","4","5","6","7","8","9","10", "11","12", "13","14","15","16","17","18","19","20", "21","22", "23","24","25","26","27")
ranklit
bwplot(weight ~ranklit | treatment*sex, data=rat_pup,aspect = 2, ylab="Birth Weights", xlab="" )
#install.packages("Hmisc")
library(Hmisc)
library(lattice)  # trellis graphics
library(grid)
library(nlme)
library(lme4)
rat_pup$sex1[sex == "Female"] <- 1
rat_pup$sex1[sex == "Male"] <- 0
rat_pup$sex1[sex == "Female"] <- 1
rat_pup$sex1[sex == "Male"] <- 0
rat_pup
model3.1.fit <- lme(weight ~ treatment + sex1 + litsize +
treatment:sex1, random = ~ 1 | litter,
data = ratpup, method = "REML")
model3.1.fit <- lme(weight ~ treatment + sex1 + litsize +
treatment:sex1, random = ~ 1 | litter,
data = rat_pup, method = "REML")
treatment <- relevel(treatment, ref = "High")
#treatment <- relevel(treatment, ref = "High")
# Summary of model fit, along with F-tests.
summary(model3.1.fit)
anova(model3.1.fit)
random.effects(model3.1.fit)
# Fit Model 3.1A.
model3.la.fit <- gls(weight ~ treatment + sex1 + litsize +
treatment:sex1, data = ratpup)
random.effects(model3.1.fit)
# Fit Model 3.1A.
model3.la.fit <- gls(weight ~ treatment + sex1 + litsize +
treatment:sex1, data = rat_pup)
anova(model3.1.fit, model3.la.fit) # Test Hypothesis 3.
model3.2a.fit <- lme(weight ~ treatment + sex1 + litsize
+ treatment:sex1, random = ~1 | litter, ratpup, method = "REML",
weights  = varIdent(form = ~1 | treatment))
model3.2a.fit <- lme(weight ~ treatment + sex1 + litsize
+ treatment:sex1, random = ~1 | litter, rat_pup, method = "REML",
weights  = varIdent(form = ~1 | treatment))
summary(model3.2a.fit)
# Test Hypothesis 3.2.
anova(model3.1.fit, model3.2a.fit)
ratpup$trtgrp[treatment == "Control"] <- 1
ratpup$trtgrp[treatment == "Control"] <- 1
rat_pup$trtgrp[treatment == "Control"] <- 1
rat_pup$trtgrp[treatment == "Low" | treatment == "High"] <- 2
model3.2b.fit <- lme(weight ~ treatment + sex1 + litsize + treatment:sex1,
random  = ~ 1 | litter, rat_pup, method = "REML",
weights = varIdent(form = ~1 | trtgrp))
# Test Hypothesis 3.3.
anova(model3.2a.fit, model3.2b.fit)
# Test Hypothesis 3.4.
anova(model3.1.fit, model3.2b.fit)
summary(model3.2b.fit)
# Test Hypothesis 3.4.
anova(model3.1.fit, model3.2b.fit)
summary(model3.2b.fit)
rat_pup$trtgrp[treatment == "Control"] <- 1
rat_pup$trtgrp[treatment == "Low" | treatment == "High"] <- 2
model3.2b.fit <- lme(weight ~ treatment + sex1 + litsize + treatment:sex1,
random  = ~ 1 | litter, rat_pup, method = "REML",
weights = varIdent(form = ~1 | trtgrp))
# Test Hypothesis 3.3.
anova(model3.2a.fit, model3.2b.fit)
# Test Hypothesis 3.4.
anova(model3.1.fit, model3.2b.fit)
summary(model3.2b.fit)
# Test Hypothesis 3.5.
anova(model3.2b.fit)
model3.3.ml.fit <- lme(weight ~ treatment + sex1 + litsize,
random = ~1 | litter, ratpup, method = "ML",
weights = varIdent(form = ~1 | trtgrp))
# Test Hypothesis 3.5.
anova(model3.2b.fit)
model3.3.ml.fit <- lme(weight ~ treatment + sex1 + litsize,
random = ~1 | litter, rat_pup, method = "ML",
weights = varIdent(form = ~1 | trtgrp))
model3.3a.ml.fit <- lme(weight ~ sex1 + litsize,
random = ~1 | litter, rat_pup, method = "ML",
weights = varIdent(form = ~1 | trtgrp))
# Test Hypothesis 3.6.
anova(model3.3.ml.fit, model3.3a.ml.fit)
model3.3.reml.fit <- lme(weight ~ sex1 + litsize + treatment,
random  = ~1 | litter, ratpup, method = "REML",
weights = varIdent(form = ~1 | trtgrp))
model3.3.reml.fit <- lme(weight ~ sex1 + litsize + treatment,
random  = ~1 | litter, rat_pup, method = "REML",
weights = varIdent(form = ~1 | trtgrp))
summary(model3.3.reml.fit)
anova(model3.3.reml.fit)
# Fit Model 3.1 (see chapter3_R_final.R for code to load the data).
model3.1.fit.lmer <- lmer(weight ~ treatment + sex1 + litsize +
treatment:sex1 + (1 | litter),
ratpup, REML = T)
# Fit Model 3.1 (see chapter3_R_final.R for code to load the data).
model3.1.fit.lmer <- lmer(weight ~ treatment + sex1 + litsize +
treatment:sex1 + (1 | litter),
rat_pup, REML = T)
# View results and 95% confidence intervals.
summary(model3.1.fit.lmer)
confint(model3.1.fit.lmer)
# Display the random effects (EBLUPs) from the model.
ranef(model3.1.fit.lmer)
# Plot the predicted random effects along with measures of uncertainty.
library(merTools)
#install.packages("Hmisc")
library(Hmisc)
library(lattice)  # trellis graphics
library(grid)
library(nlme)
library(lme4)
install.packages("merTools")
library(merTools)
install.packages("lmerTest")
library(lmerTest)
# Fit Model 3.1 (see chapter3_R_final.R for code to load the data).
model3.1.fit.lmer <- lmer(weight ~ treatment + sex1 + litsize +
treatment:sex1 + (1 | litter),
rat_pup, REML = T)
# View results and 95% confidence intervals.
summary(model3.1.fit.lmer)
confint(model3.1.fit.lmer)
# Display the random effects (EBLUPs) from the model.
ranef(model3.1.fit.lmer)
# Plot the predicted random effects along with measures of uncertainty.
REsim(model3.1.fit.lmer)
plotREsim(REsim(model3.1.fit.lmer))
# Code for obtaining p-values (if desired).
# Model 3.1.
model3.1.fit.lmer <- lmer(weight ~ treatment + sex1 + litsize +
treatment:sex1 + (1 | litter),
rat_pup, REML = T)
summary(model3.1.fit.lmer)
anova(model3.1.fit.lmer)
# Significant test for the variance component.
rand(model3.1.fit.lmer)
trellis.device(color=F)
# Generate Figure 3.4
res <- resid(model3.3.reml.fit)
ratred <- data.frame(rat_pup, res)
ratred
histogram(~res | factor(trtgrp), data=ratred, layout=c(2,1), aspect = 2 , xlab = "Residual")
# Generate Figure 3.5
qqnorm(model3.3.reml.fit, ~resid(.) | factor(trtgrp), layout=c(2,1), aspect = 2, id = 0.05)
# Generate Figure 3.6
plot(model3.3.reml.fit, resid(.) ~ fitted(.) | factor(trtgrp), layout=c(2,1), aspect=2, abline=0)
# Generate Figure 3.7 (note: these are conditional residuals)
attach(rat_pup)
ranklit <- litsize+0.01*litter
sort(ranklit)
ranklit
ranklit <- factor(ranklit)
levels(ranklit) <- c( "1","2", "3","4","5","6","7","8","9","10", "11","12", "13","14","15","16","17","18","19","20", "21","22","23","24","25","26","27")
ranklit
bwplot(resid(model3.3.reml.fit) ~ ranklit, data=model3.3.reml.fit, ylab="residual", xlab="litter")
# Influence diagnostics are not currently available.
View(rat_pup)
library(Hmisc)
library(lattice)  # trellis graphics
library(grid)
library(nlme)
library(lme4)
#install.packages("merTools")
library(merTools)
#install.packages("lmerTest")
library(lmerTest)
# Fit Model 4.1 (see chapter4_R_final.R for code to load the data).
model4.1.fit.lmer <- lmer(mathgain ~ 1 + (1|schoolid) + (1|classid),
class, REML = T)
# Fit Model 4.1 (see chapter4_R_final.R for code to load the data).
model4.1.fit.lmer <- lmer(mathgain ~ 1 + (1|schoolid) + (1|classid),
class, REML = T)
setwd("/Users/dc/test_stuff/repeated_measures/west_book")
class <- read.csv("classroom/classroom.csv", h = T)
# Fit Model 4.1 (see chapter4_R_final.R for code to load the data).
model4.1.fit.lmer <- lmer(mathgain ~ 1 + (1|schoolid) + (1|classid),
class, REML = T)
# View results and 95% confidence intervals.
summary(model4.1.fit.lmer)
confint(model4.1.fit.lmer)
# Display the random effects (EBLUPs) from the model.
ranef(model4.1.fit.lmer)
# Plot the predicted random effects along with measures of uncertainty.
library(merTools)
REsim(model4.1.fit.lmer)
plotREsim(REsim(model4.1.fit.lmer))
# Model 4.1A.
model4.1A.fit.lmer <- lmer(mathgain ~ 1 + (1|schoolid),
class, REML = T)
# Test Hypothesis 4.1.
anova(model4.1.fit.lmer, model4.1A.fit.lmer)
# Model 4.2.
model4.2.fit.lmer <- lmer(mathgain ~ mathkind + sex + minority + ses
+ (1|schoolid) + (1|classid),
class, na.action = "na.omit", REML = T)
summary(model4.2.fit.lmer)
# Model 4.1: ML estimation with lmer().
model4.1.lmer.ml.fit <- lmer(mathgain ~ 1 + (1|schoolid) + (1|classid),
class, REML = F)
# Model 4.2: ML estimation with lmer().
model4.2.lmer.ml.fit <- lmer(mathgain ~ mathkind + sex + minority + ses
+ (1|schoolid) + (1|classid),
class, REML = F)
anova(model4.1.lmer.ml.fit, model4.2.lmer.ml.fit)
# Model 4.3.
model4.3.fit.lmer <- lmer(mathgain ~ mathkind + sex + minority + ses
+ yearstea + mathprep + mathknow
+ (1|schoolid) + (1|classid),
class, na.action = "na.omit", REML = T)
summary(model4.3.fit.lmer)
# Model 4.4.
model4.4.fit.lmer <- lmer(mathgain ~ mathkind + sex + minority + ses
+ housepov + (1|schoolid) + (1|classid),
class, na.action = "na.omit", REML = T)
summary(model4.4.fit.lmer)
